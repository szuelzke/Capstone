{% extends 'index.html' %}

<!-- account variables -->
{% set account_stats = get_account_stats(account.account_id) %}
{% set budgets_stats = get_budget_stats(account.account_id) %}

{% block title %}<a href="{{ url_for('account', account_id=account.account_id)}}">Dashboard</a><span style="text-decoration: none;">{% block subtitle %}{% endblock%}</span>
{% endblock %}


{% block stylesheet %}
<link rel="stylesheet" href="{{ url_for('static', filename='transactionstable.css') }}">
{% endblock %}

{% block content %}
<div class="row">
    <div class="card no-bg view-balance">
        <a href="{{ url_for('account', account_id = account.account_id) }}">
            <h1 class="hide-text">{{ account_stats["balance"] }}</h1>
            <h2>Current Balance</h2>
        </a>
    </div>


    <a href="{{ url_for('get_budgets', account_id=account.account_id)}}" class="card card-link"><i class='fa-solid fa-circle-dollar-to-slot'></i>Edit Categories</a>

    <a href="{{ url_for('transactions', account_id=account.account_id)}}" class="card card-link c-f20"><i class='fa-solid fa-file-invoice'></i>View All Transactions</a>

    <!--<a href="" class="card card-link c-f20"><i class='fa-solid fa-share-nodes'></i>Shared Expenses</a>--->

</div>

{% block inner_content %}
<div class="row">
    <div class="card">
        <h2>Account Notifications</h2>
    </div>
    <div class="card">
        <h2>Recent Transactions</h2>
        <table id="transactions-tbl">
            <thead>
                <th class='tooltip'><i class="fa-regular fa-calendar"></i><span class='tooltiptext'>Date</span></th>
                <th class='tooltip'><i class="fa-solid fa-building-columns"></i>
                    <span class='tooltiptext'>Description</span>
                </th>
                <th class='tooltip'><i class="fa-solid fa-money-bill"></i><span class='tooltiptext'>Amount</span>
                </th>
            </thead>
            {% if transactions %}
            {% for transaction in transactions %}
            <tbody>
                <td>{{ transaction.date }}</td>
                <td>{{ transaction.title }}</td>
                <td>{{ transaction.amount }}</td>
            </tbody>
            {% endfor %}
            {% endif %}
        </table>
    </div>
</div>

<div class="row">
    <div class="card">
        <table>
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Budgeted</th>
                    <th>Activity</th>
                    <th>Available</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for id, obj in budgets_stats.items() %}
                <tr>
                    <td>{{ id }}</td>
                    <td>{{ obj["amount"] }}</td>
                    <td>{{ obj["activity"] }}</td>
                    <td>{{ obj["available"] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="row">
    <div class="card">
        <ul>
            <li>{{ account_stats["name"]}}</li>
            <li>account id = {{ account_stats["id"]}}</li>
            <li>balance = {{ account_stats["balance"]}}</li>
            <li>credit = {{ account_stats["credit"]}}</li>
            <li>debit = {{ account_stats["debit"]}}</li>
            <li>total transactions = {{ account_stats["transaction_count"]}}</li>
        </ul>
        {% for id, obj in budgets_stats.items() %}
        <ul>
        <li>{{ id }}</li>
        <li>total transactions = {{ obj["count"]}}</li>
        <li>allotted amount = {{ obj["amount"]}}</li>
        <li>available = {{ obj["available"]}}</li>
        <li>activity = {{ obj["activity"]}}</li>
        </ul>
        {% endfor%}
    </div>
</div>
{% endblock %}
{% endblock %}